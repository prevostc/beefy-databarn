version: 2

models:
  - name: daily_revenue_summary
    description: "Daily aggregation of revenue, yield, and BIFI buyback metrics (last 30 days). Provides daily totals for revenue from BIFI buybacks and feebatch harvests (treasury amounts), yield from harvest events, and BIFI buyback amounts. Limited to the last 30 days for performance."
    config:
      contract:
        enforced: true
      meta:
        primary_key: ["date_day"]
    tests:
      - dbt_utils.unique_combination_of_columns:
          arguments:
            combination_of_columns:
              - date_day
      - expect_date_exists:
          name: expect_yesterday_exists
          arguments:
            expression: date_day
            days_ago: 1
    columns:
      - name: date_day
        description: "Date of the aggregation (day level)"
        data_type: Date
        tests:
          - not_null
          - unique
      - name: revenue_usd
        description: "Total revenue from BIFI buybacks and feebatch harvests (treasury amounts) in USD for the day"
        data_type: Decimal(76, 20)
        tests:
          - not_null
          - dbt_utils.accepted_range:
              arguments:
                min_value: 0
                inclusive: true
      - name: yield_usd
        description: "Total yield from harvest events in USD for the day"
        data_type: Decimal(76, 20)
        tests:
          - not_null
          - dbt_utils.accepted_range:
              arguments:
                min_value: 0
                inclusive: true
      - name: bifi_buyback_usd
        description: "Total BIFI buyback amount in USD for the day"
        data_type: Decimal(76, 20)
        tests:
          - not_null
          - dbt_utils.accepted_range:
              arguments:
                min_value: 0
                inclusive: true
