version: 2

models:
  - name: stg_beefy_db__harvests
    description: "Staging model for harvest events from dlt beefy_db dataset"
    columns:
      - name: network_id
        description: "Network ID where the harvest occurred (references chain.network_id)"
        data_type: Int64
        codec: Delta, LZ4
        tests:
          - not_null
      - name: block_number
        description: "Block number when the harvest transaction occurred"
        data_type: Int64
        codec: Delta, LZ4
        tests:
          - not_null
      - name: txn_idx
        description: "Transaction index within the block"
        data_type: Int16
        codec: Delta, LZ4
        tests:
          - not_null
      - name: event_idx
        description: "Event index within the transaction"
        data_type: Int16
        codec: Delta, LZ4
        tests:
          - not_null
      - name: txn_timestamp
        description: "Timestamp when the harvest transaction occurred"
        data_type: DateTime64(6, 'UTC')
        codec: DoubleDelta, LZ4
        tests:
          - not_null
      - name: txn_hash
        description: "Transaction hash"
        data_type: String
        codec: LZ4
        tests:
          - not_null
      - name: vault_beefy_key
        description: "Vault identifier"
        data_type: String
        codec: LZ4
        tests:
          - not_null
      - name: harvest_amount
        description: "Amount harvested"
        data_type: Decimal256(20)
        codec: ZSTD(3)
        tests:
          - not_null
          - dbt_utils.accepted_range:
              name: harvest_amount_range
              arguments:
                min_value: 0
                inclusive: true
      - name: want_price
        description: "Price of the want token at the time of harvest"
        data_type: Decimal256(20)
        codec: ZSTD(3)
      - name: call_fee
        description: "Call fee for the harvest"
        data_type: Decimal256(20)
        codec: ZSTD(3)
        tests:
          - dbt_utils.accepted_range:
              name: call_fee_range
              arguments:
                min_value: 0
                inclusive: true
      - name: gas_fee
        description: "Gas fee for the harvest"
        data_type: Decimal256(20)
        codec: ZSTD(3)
        tests:
          - dbt_utils.accepted_range:
              name: gas_fee_range
              arguments:
                min_value: 0
                inclusive: true
      - name: platform_fee
        description: "Platform fee for the harvest"
        data_type: Decimal256(20)
        codec: ZSTD(3)
        tests:
          - dbt_utils.accepted_range:
              name: platform_fee_range
              arguments:
                min_value: 0
                inclusive: true
      - name: strategist_fee
        description: "Strategist fee for the harvest"
        data_type: Decimal256(20)
        codec: ZSTD(3)
        tests:
          - dbt_utils.accepted_range:
              name: strategist_fee_range
              arguments:
                min_value: 0
                inclusive: true
      - name: native_price
        description: "Price of native token at the time of harvest"
        data_type: Decimal256(20)
        codec: ZSTD(3)
        tests:
          - dbt_utils.accepted_range:
              name: native_price_range
              arguments:
                min_value: 0
                inclusive: true
      - name: is_cowllector
        description: "Whether this harvest is from a cowllector"
        data_type: UInt8
        codec: Delta, LZ4
      - name: strategist_address
        description: "Address of the strategist"
        data_type: String
        codec: LZ4
